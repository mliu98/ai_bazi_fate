# å…«å­—ç¼˜åˆ†æµ‹ç®— Â· Coding Agent å¼€å‘ä»»åŠ¡æ¸…å•

> **æŠ€æœ¯æ ˆ**ï¼šVue 3 + Vite + Vant Â· Node.js + Express Â· Supabase Â· DeepSeek API Â· Vercel + Railway  
> **æ‰§è¡Œæ–¹å¼**ï¼šæŒ‰é¡ºåºå®Œæˆï¼Œæ¯ä¸ªä»»åŠ¡å®Œæˆåæ ‡è®° `[x]`ï¼Œæœ‰ä¾èµ–å…³ç³»çš„ä»»åŠ¡è¯·å‹¿è·³è¿‡å‰ç½®ä»»åŠ¡

---

## ğŸ—‚ PHASE 1 Â· é¡¹ç›®åˆå§‹åŒ–ä¸åŸºç¡€æ¶æ„

### 1.1 é¡¹ç›®è„šæ‰‹æ¶

- [ ] åˆå§‹åŒ–å‰ç«¯é¡¹ç›®ï¼š`npm create vite@latest frontend -- --template vue`ï¼Œå®‰è£… Vue Routerã€Piniaã€Vantã€axios
- [ ] åˆå§‹åŒ–åç«¯é¡¹ç›®ï¼š`mkdir backend && npm init`ï¼Œå®‰è£… expressã€corsã€dotenvã€@supabase/supabase-jsã€express-rate-limit
- [ ] é…ç½® `.env` æ–‡ä»¶æ¨¡æ¿ï¼ˆå‰åç«¯å„ä¸€ä»½ï¼‰ï¼ŒåŒ…å« `SUPABASE_URL`ã€`SUPABASE_KEY`ã€`DEEPSEEK_API_KEY`ã€`ADMIN_PASSWORD`
- [ ] é…ç½® `.gitignore`ï¼Œç¡®ä¿ `.env` ä¸å…¥åº“
- [ ] åˆå§‹åŒ– Git ä»“åº“ï¼Œå»ºç«‹ `main` å’Œ `dev` åˆ†æ”¯

### 1.2 Supabase æ•°æ®åº“åˆå§‹åŒ–

- [ ] åœ¨ Supabase åˆ›å»ºé¡¹ç›®ï¼Œè·å– URL å’Œ anon key
- [ ] æ‰§è¡Œä»¥ä¸‹å»ºè¡¨ SQLï¼š

```sql
-- æ¿€æ´»ç è¡¨
CREATE TABLE activation_codes (
  code        VARCHAR(9) PRIMARY KEY,
  type        TEXT CHECK (type IN ('free', 'full', 'unlimited')),
  total_uses  INT NOT NULL,
  used_count  INT DEFAULT 0,
  created_at  TIMESTAMPTZ DEFAULT NOW(),
  expires_at  TIMESTAMPTZ,
  note        TEXT
);

-- æµ‹ç®—è®°å½•è¡¨ï¼ˆå¯é€‰ï¼Œç”¨äºè¿è¥æ•°æ®åˆ†æï¼‰
CREATE TABLE calculations (
  id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code        VARCHAR(9) REFERENCES activation_codes(code),
  created_at  TIMESTAMPTZ DEFAULT NOW(),
  score       INT,
  ip          TEXT
);
```

- [ ] ä¸º `activation_codes` è¡¨çš„ `code` å­—æ®µè®¾ç½® RLSï¼ˆRow Level Securityï¼‰ï¼Œä»…å…è®¸åç«¯ service key å†™å…¥
- [ ] é¢„ç”Ÿæˆ 10 ä¸ªä½“éªŒç ï¼ˆtype=free, total_uses=1ï¼‰ç”¨äºå¼€å‘æµ‹è¯•

### 1.3 é¡¹ç›®ç›®å½•ç»“æ„è§„èŒƒ

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ views/          # é¡µé¢ç»„ä»¶ï¼ˆHome, Activate, Input, Loading, Result, Adminï¼‰
â”‚   â”œâ”€â”€ components/     # å¤ç”¨ç»„ä»¶ï¼ˆShareCard, ReportSection, PaywallModalï¼‰
â”‚   â”œâ”€â”€ stores/         # Pinia storeï¼ˆsession, reportï¼‰
â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°ï¼ˆbazi.js å…«å­—è®¡ç®—, api.js è¯·æ±‚å°è£…ï¼‰
â”‚   â”œâ”€â”€ assets/         # é™æ€èµ„æºï¼ˆèƒŒæ™¯å›¾ã€å­—ä½“ï¼‰
â”‚   â””â”€â”€ router/         # è·¯ç”±é…ç½®

backend/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ code.js         # æ¿€æ´»ç ç›¸å…³æ¥å£
â”‚   â”œâ”€â”€ calculate.js    # æŠ¥å‘Šç”Ÿæˆæ¥å£
â”‚   â””â”€â”€ admin.js        # ç®¡ç†å‘˜æ¥å£
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ baziEngine.js   # å…«å­—è®¡ç®—è§„åˆ™å¼•æ“
â”‚   â”œâ”€â”€ aiService.js    # DeepSeek API è°ƒç”¨
â”‚   â””â”€â”€ codeService.js  # æ¿€æ´»ç ç”Ÿæˆä¸æ ¡éªŒ
â””â”€â”€ middleware/
    â””â”€â”€ auth.js         # æ¿€æ´»ç æ ¡éªŒä¸­é—´ä»¶
```

---

## ğŸ” PHASE 2 Â· æ¿€æ´»ç ç³»ç»Ÿ

### 2.1 åç«¯ï¼šæ¿€æ´»ç æœåŠ¡

- [ ] `codeService.js`ï¼šå®ç° `generateCode()` å‡½æ•°ï¼Œç”Ÿæˆæ ¼å¼ä¸º `XXXX-XXXX` çš„éšæœºæ¿€æ´»ç ï¼ˆå¤§å†™å­—æ¯+æ•°å­—ï¼Œæ’é™¤ O/0/I/1 ç­‰æ˜“æ··å­—ç¬¦ï¼‰
- [ ] `codeService.js`ï¼šå®ç° `verifyCode(code)` å‡½æ•°ï¼ŒæŸ¥è¯¢ Supabase æ ¡éªŒï¼šæ˜¯å¦å­˜åœ¨ã€æ˜¯å¦è¿‡æœŸã€æ˜¯å¦æœ‰å‰©ä½™æ¬¡æ•°ï¼Œè¿”å› `{ valid, type, remaining, error }`
- [ ] `codeService.js`ï¼šå®ç° `consumeCode(code)` å‡½æ•°ï¼Œå°† `used_count + 1`ï¼Œä½¿ç”¨ä¹è§‚é”é˜²å¹¶å‘
- [ ] `codeService.js`ï¼šå®ç° `batchGenerate(count, type, expiresInDays, note)` æ‰¹é‡ç”Ÿæˆæ¿€æ´»ç å¹¶å†™å…¥æ•°æ®åº“

### 2.2 åç«¯ï¼šæ¿€æ´»ç æ¥å£

- [ ] `POST /api/code/verify`ï¼šæ¥æ”¶ `{ code }`ï¼Œè°ƒç”¨ `verifyCode`ï¼Œè¿”å›éªŒè¯ç»“æœï¼ˆä¸æ¶ˆè€—æ¬¡æ•°ï¼‰
- [ ] ä¸ºæ‰€æœ‰ `/api/calculate` å’Œ `/api/report/full` æ¥å£æ·»åŠ  `auth.js` ä¸­é—´ä»¶ï¼šè¯·æ±‚å¤´æºå¸¦ `X-Activation-Code`ï¼Œä¸­é—´ä»¶æ ¡éªŒå¹¶å°† code ä¿¡æ¯æ³¨å…¥ `req.codeInfo`

### 2.3 å‰ç«¯ï¼šæ¿€æ´»ç è¾“å…¥é¡µï¼ˆ`/activate`ï¼‰

- [ ] é¡µé¢å¸ƒå±€ï¼šäº§å“ Logo + ä¸€å¥è¯è¯´æ˜ + æ¿€æ´»ç è¾“å…¥æ¡†ï¼ˆè‡ªåŠ¨æ ¼å¼åŒ–ä¸º `XXXX-XXXX`ï¼‰+ ç¡®è®¤æŒ‰é’®
- [ ] è¾“å…¥æ¡†å®ç°ï¼šç›‘å¬è¾“å…¥è‡ªåŠ¨åœ¨ç¬¬ 4 ä½åæ’å…¥ `-`ï¼Œå¤§å†™è½¬æ¢ï¼Œé•¿åº¦é™åˆ¶ 9 ä½
- [ ] è°ƒç”¨ `POST /api/code/verify`ï¼Œæ ¡éªŒé€šè¿‡åå°† code å’Œ type å­˜å…¥ Pinia session store å’Œ localStorage
- [ ] é”™è¯¯çŠ¶æ€å¤„ç†ï¼šæ— æ•ˆç  / å·²è¿‡æœŸ / æ¬¡æ•°ç”¨å®Œï¼Œåˆ†åˆ«å±•ç¤ºä¸åŒæç¤ºæ–‡æ¡ˆ
- [ ] æ ¡éªŒæˆåŠŸåè·¯ç”±è·³è½¬åˆ° `/input`
- [ ] å…¨å±€è·¯ç”±å®ˆå«ï¼šæ— æœ‰æ•ˆ code åœ¨ session ä¸­æ—¶ï¼Œè®¿é—® `/input`ã€`/result` ç­‰é¡µé¢è‡ªåŠ¨è·³è½¬åˆ° `/activate`

---

## ğŸ“ PHASE 3 Â· ç”¨æˆ·è¾“å…¥æµç¨‹

### 3.1 å‰ç«¯ï¼šä¿¡æ¯è¾“å…¥é¡µï¼ˆ`/input`ï¼‰

- [ ] Step 1 â€” ç”Ÿæ—¥è¾“å…¥ï¼š
  - ä½¿ç”¨ Vant `DatePicker` å®ç°å¹´/æœˆ/æ—¥é€‰æ‹©ï¼ŒèŒƒå›´ 1970-2010 å¹´
  - æ—¶è¾°é€‰æ‹©ï¼š12 ä¸ªé€‰é¡¹ + ã€Œä¸çŸ¥é“ã€ï¼Œå±•ç¤ºä¸ºã€Œå­æ—¶ï¼ˆ23-1ç‚¹ï¼‰ã€æ ¼å¼
  - æ€§åˆ«é€‰æ‹©ï¼šå¤§æŒ‰é’®å•é€‰ï¼Œã€Œæˆ‘æ˜¯å¥³ç”Ÿã€/ ã€Œæˆ‘æ˜¯ç”·ç”Ÿã€
  - å¯¹æ–¹ç”Ÿæ—¥ï¼šåŒç»“æ„ï¼Œå­—æ®µåå‰ç¼€ `partner_`
- [ ] Step 2 â€” ç„å­¦é—®å·ï¼š
  - 5 é“å•é€‰é¢˜ï¼Œæ¯é¢˜é€‰é¡¹ç”¨å¤§å¡ç‰‡æŒ‰é’®å±•ç¤º
  - é€‰ä¸­çŠ¶æ€æœ‰æ˜æ˜¾é«˜äº®ï¼ˆçº¢è‰²æè¾¹ + èƒŒæ™¯è‰²ï¼‰
  - æ¯æ¬¡åªæ˜¾ç¤ºä¸€é¢˜ï¼Œæ”¯æŒä¸Šä¸€é¢˜/ä¸‹ä¸€é¢˜å¯¼èˆªï¼Œæœ€åä¸€é¢˜æ˜¾ç¤ºã€Œå¼€å§‹æµ‹ç®—ã€æŒ‰é’®
- [ ] è¡¨å•æ•°æ®æ”¶é›†å®Œæ¯•åå­˜å…¥ Pinia storeï¼Œè·³è½¬åˆ° `/loading`

### 3.2 å‰ç«¯ï¼šLoading é¡µï¼ˆ`/loading`ï¼‰

- [ ] å±•ç¤ºå…«å­—æ’ç›˜åŠ¨æ•ˆï¼ˆCSS åŠ¨ç”»ï¼Œå¤©å¹²åœ°æ”¯å­—ç¬¦è½®æ’­ï¼‰
- [ ] éšæœºå±•ç¤º 5 æ¡ç„å­¦è¯­å½•ï¼Œæ¯ 1.5 ç§’åˆ‡æ¢ä¸€æ¡
- [ ] åŒæ—¶è§¦å‘ `POST /api/calculate` è¯·æ±‚
- [ ] è¯·æ±‚å®Œæˆåç­‰å¾…è‡³å°‘ 3 ç§’ï¼ˆä½“éªŒæ„Ÿï¼‰ï¼Œç„¶åè·³è½¬åˆ° `/result`
- [ ] è¯·æ±‚å¤±è´¥å¤„ç†ï¼šå±•ç¤ºé”™è¯¯æç¤º + é‡è¯•æŒ‰é’®

---

## âš™ï¸ PHASE 4 Â· å…«å­—è®¡ç®—å¼•æ“ï¼ˆåç«¯ï¼‰

> æ³¨æ„ï¼šå…«å­—è®¡ç®—æ˜¯çº¯è§„åˆ™é€»è¾‘ï¼Œä¸ä¾èµ–å¤§æ¨¡å‹ï¼Œå…ˆå®Œæˆæ­¤æ¨¡å—å†æ¥å…¥ AI

### 4.1 å…«å­—åŸºç¡€è®¡ç®—

- [ ] `baziEngine.js`ï¼šå®ç° `getBazi(year, month, day, hour)` å‡½æ•°
  - è®¡ç®—å¹´æŸ±ï¼ˆå¤©å¹²åœ°æ”¯ï¼‰ï¼šä»¥ç«‹æ˜¥ä¸ºç•Œæ¢å¹´
  - è®¡ç®—æœˆæŸ±ï¼šæŒ‰èŠ‚æ°”ï¼ˆå¯ä½¿ç”¨æŸ¥è¡¨æ³•ï¼Œå†…ç½® 2000-2040 å¹´èŠ‚æ°”è¡¨ï¼‰
  - è®¡ç®—æ—¥æŸ±ï¼šä½¿ç”¨å…¬å¼æ³•ï¼ˆè”¡å‹’å…¬å¼å˜ä½“ï¼‰è®¡ç®—æ—¥å¹²æ”¯
  - è®¡ç®—æ—¶æŸ±ï¼šæŒ‰æ—¶è¾°å¯¹åº”åœ°æ”¯ï¼Œå¤©å¹²ç”±æ—¥å¹²æ¨ç®—
  - è¿”å›ï¼š`{ year: {gan, zhi}, month: {gan, zhi}, day: {gan, zhi}, hour: {gan, zhi} }`
- [ ] `baziEngine.js`ï¼šå®ç° `getWuxing(bazi)` å‡½æ•°ï¼Œç»Ÿè®¡å››æŸ±ä¸­é‡‘æœ¨æ°´ç«åœŸå„å…ƒç´ æ•°é‡
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•ï¼šè‡³å°‘ 10 ä¸ªå·²çŸ¥ç”Ÿæ—¥çš„å…«å­—å¯¹ç…§ï¼ˆå¯ä»ç½‘ä¸ŠæŸ¥è¯ï¼‰ï¼Œç¡®ä¿è®¡ç®—å‡†ç¡®

### 4.2 åˆå©šè¯„åˆ†å¼•æ“

- [ ] `baziEngine.js`ï¼šå®ç°åˆå©šå…³ç³»æŸ¥è¡¨ï¼š
  - å…­åˆè¡¨ï¼ˆå­ä¸‘åˆã€å¯…äº¥åˆã€å¯æˆŒåˆã€è¾°é…‰åˆã€å·³ç”³åˆã€åˆæœªåˆï¼‰
  - ä¸‰åˆè¡¨ï¼ˆç”³å­è¾°ã€äº¥å¯æœªã€å¯…åˆæˆŒã€å·³é…‰ä¸‘ï¼‰
  - å…­å†²è¡¨ï¼ˆå­åˆå†²ã€ä¸‘æœªå†²ã€å¯…ç”³å†²ã€å¯é…‰å†²ã€è¾°æˆŒå†²ã€å·³äº¥å†²ï¼‰
  - ç›¸å…‹è¡¨ï¼ˆåŸºäºå¤©å¹²ï¼šç”²å…‹æˆŠã€ä¹™å…‹å·±ç­‰ï¼‰
- [ ] `baziEngine.js`ï¼šå®ç° `calcCompatibility(bazi1, bazi2)` å‡½æ•°ï¼š
  - æ—¥æŸ±ç›¸åˆ +20 åˆ†ï¼ŒæœˆæŸ±ç›¸åˆ +15 åˆ†ï¼Œå¹´æŸ±ç›¸åˆ +10 åˆ†ï¼Œæ—¶æŸ±ç›¸åˆ +5 åˆ†
  - æ—¥æŸ±ç›¸å†² -15 åˆ†ï¼ŒæœˆæŸ±ç›¸å†² -10 åˆ†
  - äº”è¡Œäº’è¡¥ï¼ˆåŒæ–¹äº”è¡Œç›¸ç”Ÿï¼‰+10 åˆ†
  - äº”è¡Œç›¸å…‹ -10 åˆ†
  - åŸºç¡€åˆ† 50ï¼Œæœ€ç»ˆåˆ†æ•°é™åˆ¶åœ¨ 55-99 èŒƒå›´å†…
  - è¿”å›ï¼š`{ score, level, highlights_flags, warning_flags, wuxing_relation }`

---

## ğŸ¤– PHASE 5 Â· AI æŠ¥å‘Šç”Ÿæˆï¼ˆåç«¯ï¼‰

### 5.1 DeepSeek API é›†æˆ

- [ ] `aiService.js`ï¼šå°è£… DeepSeek API è°ƒç”¨ï¼Œbase URL ä¸º `https://api.deepseek.com`ï¼Œæ¨¡å‹ `deepseek-chat`
- [ ] å®ç°è¯·æ±‚è¶…æ—¶ï¼ˆ15sï¼‰å’Œé‡è¯•æœºåˆ¶ï¼ˆå¤±è´¥æœ€å¤šé‡è¯• 2 æ¬¡ï¼‰
- [ ] å®ç°å“åº”è§£æï¼šä»è¿”å›å†…å®¹ä¸­æå– JSONï¼Œå¤„ç†æ¨¡å‹å¯èƒ½è¾“å‡ºçš„ markdown ä»£ç å—åŒ…è£¹

### 5.2 Prompt å·¥ç¨‹

- [ ] `aiService.js`ï¼šå®ç° `generateReport(baziData, surveyAnswers, codeType)` å‡½æ•°
- [ ] Prompt æ¨¡æ¿ï¼ˆç³»ç»Ÿæç¤ºï¼‰ï¼š

```
ä½ æ˜¯ä¸€ä½ç²¾é€šå…«å­—åˆå©šçš„å‘½ç†å¸ˆï¼Œæ“…é•¿ç”¨ç°ä»£å¹´è½»äººå¬å¾—æ‡‚çš„è¯­è¨€è§£è¯»å‘½ç›˜ã€‚
è¯­è¨€è¦æ±‚ï¼šå£è¯­åŒ–ã€æœ‰æ¸©åº¦ã€å¸¦æƒ…ç»ªæ„Ÿï¼Œåˆä¸­è¯­æ–‡æ°´å¹³å³å¯è¯»æ‡‚ï¼Œé€‚å½“ä½¿ç”¨ emojiã€‚
ç¦æ­¢å‡ºç°ï¼šã€Œæ¯«æ— ç¼˜åˆ†ã€ã€Œæ³¨å®šåˆ†ç¦»ã€ã€Œå¿…ç„¶å¤±è´¥ã€ç­‰æç«¯è´Ÿé¢è¡¨è¿°ã€‚
å¿…é¡»ä»¥ JSON æ ¼å¼è¾“å‡ºï¼Œä¸è¦è¾“å‡ºä»»ä½•å…¶ä»–å†…å®¹ã€‚
```

- [ ] Prompt ç”¨æˆ·è¾“å…¥ç»“æ„ï¼š

```
å…«å­—ä¿¡æ¯ï¼š{bazi1} vs {bazi2}
äº”è¡Œå…³ç³»ï¼š{wuxing_relation}
ç¼˜åˆ†å¾—åˆ†ï¼š{score}ï¼ˆæ»¡åˆ†99ï¼‰
ç­‰çº§ï¼š{level}
äº®ç‚¹æ ‡ç­¾ï¼š{highlight_flags}
éšæ‚£æ ‡ç­¾ï¼š{warning_flags}
é—®å·ç­”æ¡ˆï¼š{survey_answers}

è¯·è¾“å‡º JSONï¼š
{
  "highlights": ["äº®ç‚¹1", "äº®ç‚¹2", "äº®ç‚¹3"],  // 3-5æ¡ï¼Œæ­£å‘ï¼Œæ¯æ¡30å­—å†…
  "advice": ["å»ºè®®1", "å»ºè®®2", "å»ºè®®3"],        // 3æ¡ç›¸å¤„å»ºè®®ï¼Œå£è¯­åŒ–
  "sign": "ä¸“å±å§»ç¼˜ç­¾å…¨æ–‡",                      // 60-80å­—ï¼Œè¯—æ„ï¼Œå¸¦æƒ…ç»ª
  "share_text": "åˆ†äº«æ–‡æ¡ˆ",                       // 80å­—å†…ï¼Œé€‚åˆå°çº¢ä¹¦ï¼Œå¸¦æ‚¬å¿µ
  "warning": "éšæ‚£é¢„è­¦å†…å®¹",                      // 50å­—å†…ï¼Œå§”å©‰è¡¨è¾¾
  "timing": "æœ€ä½³å‘å±•æ—¶æœºæè¿°"                    // å…·ä½“åˆ°æœˆä»½ï¼Œæœ‰æ¸©åº¦
}
```

- [ ] å¯¹ AI è¾“å‡ºåšå†…å®¹è¿‡æ»¤ï¼šæ£€æŸ¥ `warning` å­—æ®µæ˜¯å¦åŒ…å«æç«¯è´Ÿé¢è¯æ±‡ï¼Œè‹¥æœ‰åˆ™æ›¿æ¢ä¸ºæ¸©å’Œç‰ˆæœ¬
- [ ] å¦‚æœ codeType ä¸º `free`ï¼Œä¸ç”Ÿæˆ `warning` å’Œ `timing` å­—æ®µï¼ˆèŠ‚çœ tokenï¼‰

### 5.3 æŠ¥å‘Šç”Ÿæˆæ¥å£

- [ ] `POST /api/calculate`ï¼š
  - ä»è¯·æ±‚ä½“è·å–ï¼š`{ selfBirthday, partnerBirthday, selfGender, survey }`
  - è°ƒç”¨ `getBazi` è®¡ç®—åŒæ–¹å…«å­—
  - è°ƒç”¨ `calcCompatibility` è·å–è¯„åˆ†å’Œæ ‡ç­¾
  - è°ƒç”¨ `aiService.generateReport` è·å– AI æ–‡æ¡ˆ
  - æ¶ˆè€—æ¿€æ´»ç ä¸€æ¬¡ï¼ˆè°ƒç”¨ `consumeCode`ï¼‰
  - è¿”å›å®Œæ•´æŠ¥å‘Šæ•°æ®ï¼ˆå…è´¹ç‰ˆä¸å« warning/timingï¼‰
  - è®°å½•ä¸€æ¡ calculations è®°å½•
- [ ] `POST /api/report/full`ï¼š
  - æ ¡éªŒ codeType å¿…é¡»ä¸º `full` æˆ– `unlimited`ï¼Œå¦åˆ™è¿”å› 403
  - é‡æ–°ç”Ÿæˆå« warning + timing çš„å®Œæ•´æŠ¥å‘Šï¼ˆæˆ–ä»ç¼“å­˜è¯»å–ï¼‰
  - ä¸å†æ¶ˆè€—æ¬¡æ•°ï¼ˆåŒä¸€æ¬¡æµ‹ç®—çš„è¡¥å……å†…å®¹ï¼‰

---

## ğŸ“Š PHASE 6 Â· æŠ¥å‘Šå±•ç¤ºé¡µï¼ˆå‰ç«¯ï¼‰

### 6.1 æŠ¥å‘Šé¡µï¼ˆ`/result`ï¼‰

- [ ] é¡¶éƒ¨ï¼šç¼˜åˆ†æ€»åˆ†å¤§æ•°å­—åŠ¨ç”»ï¼ˆä» 0 è®¡æ•°åˆ°æœ€ç»ˆåˆ†å€¼ï¼Œè€—æ—¶ 1.5sï¼‰+ ç­‰çº§æ ‡ç­¾ badge
- [ ] äº”è¡Œç›¸åˆæ¨¡å—ï¼šåŒæ–¹äº”è¡Œç”¨å½©è‰²æ ‡ç­¾å±•ç¤ºï¼ˆé‡‘=é»„ã€æœ¨=ç»¿ã€æ°´=è“ã€ç«=çº¢ã€åœŸ=æ£•ï¼‰ï¼Œä¸€å¥è¯æ€»ç»“
- [ ] ç¼˜åˆ†äº®ç‚¹ï¼š3-5 æ¡ï¼Œæ¯æ¡ç”¨å¡ç‰‡å±•ç¤ºï¼Œå¸¦å›¾æ ‡ï¼ˆâœ¨ï¼‰
- [ ] ç›¸å¤„å»ºè®®ï¼š3 æ¡ï¼Œåˆ—è¡¨å±•ç¤º
- [ ] ä¸“å±å§»ç¼˜ç­¾ï¼šç‹¬ç«‹å¡ç‰‡ï¼Œå±…ä¸­å¤§å­—å±•ç¤ºï¼ŒèƒŒæ™¯æ¸å˜ï¼Œæœ‰ã€Œå¤åˆ¶ç­¾æ–‡ã€æŒ‰é’®
- [ ] ä»˜è´¹å¢™ï¼šã€Œéšæ‚£é¢„è­¦ã€å’Œã€Œæœ€ä½³å‘å±•æ—¶æœºã€æ¨¡å—ç”¨æ¯›ç»ç’ƒæ¨¡ç³Šæ•ˆæœé®ç›–ï¼Œæ˜¾ç¤ºã€Œå®Œæ•´ç‰ˆã€badge + å¼•å¯¼æ–‡æ¡ˆ + ã€Œè·å–å®Œæ•´ç‰ˆã€æŒ‰é’®
- [ ] ç‚¹å‡»ã€Œè·å–å®Œæ•´ç‰ˆã€å¼¹å‡º Modalï¼Œå±•ç¤ºï¼šå°çº¢ä¹¦è´¦å·å + ç§ä¿¡å¼•å¯¼æ–‡æ¡ˆ + ä»·æ ¼è¯´æ˜
- [ ] å®Œæ•´ç ç”¨æˆ·ç›´æ¥å±•ç¤ºå…¨éƒ¨å†…å®¹ï¼Œæ— ä»˜è´¹å¢™
- [ ] åº•éƒ¨ï¼šåˆ†äº«åŒºåŸŸï¼ˆä¿å­˜å›¾ç‰‡å¡ç‰‡ + å¤åˆ¶æ–‡å­—æŒ‰é’®ï¼‰

### 6.2 åˆ†äº«å›¾ç‰‡å¡ç‰‡

- [ ] ä½¿ç”¨ `html2canvas` å°†å¡ç‰‡ DOM è½¬ä¸º PNG
- [ ] å¡ç‰‡è®¾è®¡ï¼ˆ1080Ã—1080px æ¯”ä¾‹ï¼‰ï¼š
  - èƒŒæ™¯ï¼šæ·±è‰²å›½é£çº¹ç†ï¼ˆå¯ä½¿ç”¨ CSS æ¸å˜æ¨¡æ‹Ÿï¼‰
  - é¡¶éƒ¨ï¼šäº§å“åã€Œå…«å­—ç¼˜åˆ†æµ‹ç®—ã€+ çº¢è‰²å°ç« é£æ ¼ Logo
  - ä¸­éƒ¨ï¼šç¼˜åˆ†åˆ†æ•°å¤§å­— + ç­‰çº§æ ‡ç­¾
  - ä¸‹éƒ¨ï¼šä¸“å±å§»ç¼˜ç­¾æ–‡å­—ï¼ˆé™ 2 è¡Œï¼‰
  - åº•éƒ¨ï¼šã€Œæ‰«ç æµ‹ä½ çš„ç¼˜åˆ†ã€+ äºŒç»´ç å ä½å›¾ï¼ˆç”¨ qrcode.js ç”Ÿæˆå½“å‰é¡µé¢é“¾æ¥ï¼‰
- [ ] ç‚¹å‡»ã€Œä¿å­˜å›¾ç‰‡ã€è§¦å‘ä¸‹è½½ï¼Œæ–‡ä»¶åä¸ºã€Œæˆ‘çš„ç¼˜åˆ†æµ‹ç®—.pngã€
- [ ] ç‚¹å‡»ã€Œå¤åˆ¶æ–‡å­—ã€å°†åˆ†äº«æ–‡æ¡ˆå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå±•ç¤ºã€Œå·²å¤åˆ¶ã€toast

---

## ğŸ›  PHASE 7 Â· è¿è¥åå°ï¼ˆå‰ç«¯ + åç«¯ï¼‰

### 7.1 åç«¯ï¼šç®¡ç†å‘˜æ¥å£

- [ ] æ‰€æœ‰ `/api/admin/*` æ¥å£éœ€è¦ `Authorization: Bearer {ADMIN_PASSWORD}` è¯·æ±‚å¤´æ ¡éªŒ
- [ ] `POST /api/admin/codes/generate`ï¼šæ¥æ”¶ `{ count, type, expiresInDays, note }`ï¼Œæ‰¹é‡ç”Ÿæˆæ¿€æ´»ç ï¼Œè¿”å›ç”Ÿæˆçš„ç åˆ—è¡¨
- [ ] `GET /api/admin/codes/list`ï¼šæ”¯æŒ `?type=&used=&page=` æŸ¥è¯¢å‚æ•°ï¼Œè¿”å›æ¿€æ´»ç åˆ—è¡¨å’Œç»Ÿè®¡æ•°æ®
- [ ] `POST /api/admin/codes/revoke`ï¼šæ¥æ”¶ `{ code }`ï¼Œå°†è¯¥ç  `used_count` è®¾ä¸º `total_uses`ï¼ˆå³ä½œåºŸï¼‰
- [ ] `GET /api/admin/stats`ï¼šè¿”å›æ€»æµ‹ç®—æ¬¡æ•°ã€ä»Šæ—¥æµ‹ç®—æ¬¡æ•°ã€å„ç±»å‹ç æ•°é‡ç­‰ç»Ÿè®¡

### 7.2 å‰ç«¯ï¼šè¿è¥åå°ï¼ˆ`/admin`ï¼‰

- [ ] è®¿é—® `/admin` æ—¶å¼¹å‡ºå¯†ç è¾“å…¥æ¡†ï¼Œå¯†ç æ­£ç¡®åå­˜å…¥ sessionStorageï¼Œé”™è¯¯åˆ™æ‹’ç»è®¿é—®
- [ ] Tab 1ã€Œç”Ÿæˆæ¿€æ´»ç ã€ï¼š
  - è¡¨å•ï¼šæ•°é‡ï¼ˆ10/50/100/è‡ªå®šä¹‰ï¼‰ã€ç±»å‹ï¼ˆä½“éªŒ/å®Œæ•´/æ— é™ï¼‰ã€æœ‰æ•ˆå¤©æ•°ã€å¤‡æ³¨
  - ç‚¹å‡»ã€Œç”Ÿæˆã€è°ƒç”¨æ¥å£ï¼Œå°†è¿”å›çš„ç åˆ—è¡¨å±•ç¤ºåœ¨ä¸‹æ–¹ï¼Œä¸€é”®å¤åˆ¶å…¨éƒ¨
- [ ] Tab 2ã€Œæ¿€æ´»ç åˆ—è¡¨ã€ï¼š
  - è¡¨æ ¼å±•ç¤ºï¼šç  / ç±»å‹ / å·²ç”¨/æ€»æ¬¡æ•° / è¿‡æœŸæ—¶é—´ / å¤‡æ³¨ / æ“ä½œï¼ˆä½œåºŸï¼‰
  - æ”¯æŒæŒ‰ç±»å‹ã€æ˜¯å¦ç”¨å®Œè¿‡æ»¤
- [ ] Tab 3ã€Œæ•°æ®ç»Ÿè®¡ã€ï¼šå±•ç¤ºæ€»æµ‹ç®—æ¬¡æ•°ã€ä»Šæ—¥æ–°å¢ã€å„ç±»å‹ç ä½¿ç”¨æƒ…å†µ

---

## ğŸ§ª PHASE 8 Â· æµ‹è¯•

### 8.1 åç«¯å•å…ƒæµ‹è¯•

- [ ] å®‰è£… Jestï¼Œé…ç½®æµ‹è¯•è„šæœ¬ `npm test`
- [ ] æµ‹è¯• `baziEngine.js`ï¼š
  - [ ] è‡³å°‘éªŒè¯ 10 ä¸ªå·²çŸ¥ç”Ÿæ—¥çš„å…«å­—è®¡ç®—ç»“æœï¼ˆä»æƒå¨ç½‘ç«™å¯¹ç…§ï¼‰
  - [ ] æµ‹è¯•è¾¹ç•Œï¼šç«‹æ˜¥å‰åçš„å¹´æŸ±åˆ‡æ¢ã€å¤œå­æ—¶çš„æ—¶æŸ±è®¡ç®—
  - [ ] æµ‹è¯•åˆå©šè¯„åˆ†ï¼šå…­åˆã€å…­å†²ã€ä¸‰åˆç­‰å…³ç³»æ˜¯å¦æ­£ç¡®å½±å“åˆ†æ•°
- [ ] æµ‹è¯• `codeService.js`ï¼š
  - [ ] ç”Ÿæˆçš„ç æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆ`XXXX-XXXX`ï¼Œæ— æ··æ·†å­—ç¬¦ï¼‰
  - [ ] éªŒè¯ç ï¼šæœ‰æ•ˆç  / è¿‡æœŸç  / ç”¨å®Œçš„ç  / ä¸å­˜åœ¨çš„ç  å„è‡ªè¿”å›æ­£ç¡®ç»“æœ
  - [ ] å¹¶å‘æ¶ˆè€—ï¼šåŒä¸€ä¸ªç åŒæ—¶è¢«æ¶ˆè€— 2 æ¬¡ï¼Œæœ€ç»ˆ used_count æ˜¯å¦æ­£ç¡®é€’å¢ï¼ˆä¸è¶…å‡º total_usesï¼‰

### 8.2 API é›†æˆæµ‹è¯•

- [ ] ä½¿ç”¨ Postman æˆ– `.http` æ–‡ä»¶ç¼–å†™ä»¥ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼š
  - [ ] æ­£å¸¸æµç¨‹ï¼šéªŒè¯ç  â†’ ç”ŸæˆæŠ¥å‘Šï¼ˆä½“éªŒç ï¼‰â†’ ç¡®è®¤æ¬¡æ•°å‡å°‘
  - [ ] å®Œæ•´ç æµç¨‹ï¼šéªŒè¯ç  â†’ ç”ŸæˆæŠ¥å‘Š â†’ è·å–å®Œæ•´æŠ¥å‘Šï¼ˆå« warning/timingï¼‰
  - [ ] æ¬¡æ•°è€—å°½ï¼šä½¿ç”¨å®Œçš„ä½“éªŒç å†æ¬¡è°ƒç”¨ `/api/calculate` è¿”å› 403
  - [ ] æ— æ•ˆæ¿€æ´»ç ï¼šè¿”å›æ­£ç¡®é”™è¯¯ä¿¡æ¯
  - [ ] ç®¡ç†å‘˜æ¥å£ï¼šæ—  token / é”™è¯¯ token è¿”å› 401ï¼›æ­£ç¡® token æ­£å¸¸ä½¿ç”¨

### 8.3 å‰ç«¯åŠŸèƒ½æµ‹è¯•

- [ ] æ¿€æ´»ç è¾“å…¥é¡µï¼šè‡ªåŠ¨æ ¼å¼åŒ–ï¼ˆæ’å…¥`-`ï¼‰ã€å¤§å†™è½¬æ¢ã€é”™è¯¯æç¤ºã€æˆåŠŸè·³è½¬
- [ ] ç”Ÿæ—¥è¾“å…¥ï¼šæ‰€æœ‰å­—æ®µå¿…å¡«æ ¡éªŒã€æ—¶è¾°ã€Œä¸çŸ¥é“ã€å¯é€‰
- [ ] é—®å·ï¼šå‰è¿›/åé€€ã€æœ€åä¸€é¢˜æäº¤ã€è·³é¢˜é˜»æ–­
- [ ] Loading é¡µï¼šåŠ¨æ•ˆæ­£å¸¸ã€è¯·æ±‚å¤±è´¥é‡è¯•
- [ ] æŠ¥å‘Šé¡µï¼šåˆ†æ•°åŠ¨ç”»ã€å…è´¹å†…å®¹å±•ç¤ºã€ä»˜è´¹å¢™é®ç›–æ•ˆæœã€å®Œæ•´ç æ— ä»˜è´¹å¢™
- [ ] åˆ†äº«åŠŸèƒ½ï¼šå›¾ç‰‡ç”Ÿæˆä¸ä¸‹è½½ã€å¤åˆ¶æ–‡å­— toast

### 8.4 å…¼å®¹æ€§æµ‹è¯•

- [ ] åœ¨ä»¥ä¸‹ç¯å¢ƒæµ‹è¯•å®Œæ•´æµç¨‹ï¼š
  - [ ] iOS Safariï¼ˆiPhone 12 åŠä»¥ä¸Šï¼‰
  - [ ] Android Chrome
  - [ ] å¾®ä¿¡å†…ç½®æµè§ˆå™¨ï¼ˆiOS + Androidï¼‰
- [ ] é‡ç‚¹æ£€æŸ¥ï¼šVant DatePicker åœ¨å¾®ä¿¡æµè§ˆå™¨ä¸­çš„å…¼å®¹æ€§ã€html2canvas å›¾ç‰‡ç”Ÿæˆã€å¤åˆ¶åˆ°å‰ªè´´æ¿ API

### 8.5 æ€§èƒ½ä¸å®‰å…¨æµ‹è¯•

- [ ] æ¥å£é™æµï¼šé…ç½® express-rate-limitï¼Œ`/api/calculate` æ¯ä¸ª IP æ¯åˆ†é’Ÿæœ€å¤š 5 æ¬¡è¯·æ±‚
- [ ] æ¿€æ´»ç æš´åŠ›æšä¸¾é˜²æŠ¤ï¼šè¿ç»­ 5 æ¬¡éªŒè¯å¤±è´¥çš„ IP å°ç¦ 10 åˆ†é’Ÿ
- [ ] DeepSeek API è¶…æ—¶æµ‹è¯•ï¼šæ¨¡æ‹Ÿ API è¶…æ—¶ï¼Œç¡®è®¤é‡è¯•æœºåˆ¶å’Œå‰ç«¯é”™è¯¯å¤„ç†æ­£å¸¸
- [ ] å›¾ç‰‡å¡ç‰‡ç”Ÿæˆå‹åŠ›æµ‹è¯•ï¼šå¿«é€Ÿç‚¹å‡»ã€Œä¿å­˜å›¾ç‰‡ã€å¤šæ¬¡ï¼Œç¡®è®¤ä¸ä¼šé‡å¤è§¦å‘

---

## ğŸš€ PHASE 9 Â· éƒ¨ç½²ä¸ä¸Šçº¿

### 9.1 å‰ç«¯éƒ¨ç½²ï¼ˆVercelï¼‰

- [ ] åœ¨ Vercel åˆ›å»ºé¡¹ç›®ï¼Œå…³è” GitHub ä»“åº“ `frontend/` ç›®å½•
- [ ] é…ç½®ç¯å¢ƒå˜é‡ï¼š`VITE_API_BASE_URL=https://your-backend.railway.app`
- [ ] é…ç½® `vercel.json`ï¼Œå°†æ‰€æœ‰è·¯ç”±é‡å®šå‘åˆ° `index.html`ï¼ˆSPA è·¯ç”±ï¼‰ï¼š

```json
{
  "rewrites": [{ "source": "/(.*)", "destination": "/index.html" }]
}
```

- [ ] è§¦å‘é¦–æ¬¡éƒ¨ç½²ï¼ŒéªŒè¯é¡µé¢å¯è®¿é—®
- [ ] é…ç½®è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

### 9.2 åç«¯éƒ¨ç½²ï¼ˆRailwayï¼‰

- [ ] åœ¨ Railway åˆ›å»ºé¡¹ç›®ï¼Œå…³è” GitHub ä»“åº“ `backend/` ç›®å½•
- [ ] é…ç½®æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼š`SUPABASE_URL`ã€`SUPABASE_SERVICE_KEY`ã€`DEEPSEEK_API_KEY`ã€`ADMIN_PASSWORD`ã€`FRONTEND_URL`ï¼ˆç”¨äº CORS ç™½åå•ï¼‰
- [ ] ç¡®è®¤ Railway è‡ªåŠ¨æ£€æµ‹ `package.json` çš„ `start` è„šæœ¬å¹¶å¯åŠ¨æœåŠ¡
- [ ] éªŒè¯åç«¯å¥åº·æ£€æŸ¥æ¥å£ `GET /health` è¿”å› 200

### 9.3 ä¸Šçº¿å‰æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰ç¯å¢ƒå˜é‡å·²åœ¨ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼Œæ—  `.env` æ–‡ä»¶æ³„éœ²
- [ ] åç«¯ CORS ä»…å…è®¸ Vercel åŸŸåï¼ˆé `*`ï¼‰
- [ ] Supabase RLS å·²å¯ç”¨ï¼Œé service key æ— æ³•ç›´æ¥å†™å…¥æ¿€æ´»ç è¡¨
- [ ] ç®¡ç†å‘˜åå°è·¯ç”±åœ¨ç”Ÿäº§ç¯å¢ƒå¯è®¿é—®ï¼Œå¯†ç è¶³å¤Ÿå¤æ‚
- [ ] é¢„å…ˆç”Ÿæˆ 50 ä¸ªä½“éªŒç  + 20 ä¸ªå®Œæ•´ç å¤‡ç”¨
- [ ] DeepSeek API ä½™é¢å……è¶³ï¼ˆå»ºè®®å……å€¼ Â¥50 èµ·æ­¥ï¼‰
- [ ] åœ¨çœŸæœºï¼ˆiOS + Android + å¾®ä¿¡ï¼‰å®Œæ•´èµ°ä¸€éæµ‹ç®—æµç¨‹
- [ ] åˆ†äº«å›¾ç‰‡å¡ç‰‡ä¸‹è½½æ­£å¸¸ï¼ŒäºŒç»´ç æŒ‡å‘æ­£ç¡®çš„ç”Ÿäº§ç¯å¢ƒé“¾æ¥

### 9.4 ä¸Šçº¿åç›‘æ§

- [ ] åœ¨ Railway Dashboard é…ç½®å†…å­˜/CPU å‘Šè­¦
- [ ] åœ¨ Supabase Dashboard ç›‘æ§æ•°æ®åº“è¿æ¥æ•°
- [ ] é…ç½®ç®€å•çš„é”™è¯¯ä¸ŠæŠ¥ï¼ˆå¯ç”¨ `console.error` å…ˆè®°å½•åˆ° Railway æ—¥å¿—ï¼Œåç»­æ¥å…¥ Sentryï¼‰
- [ ] ä¸Šçº¿åå‰ 48 å°æ—¶æ¯æ—¥æŸ¥çœ‹ Railway æ—¥å¿—ï¼Œç¡®è®¤æ— å¼‚å¸¸æŠ¥é”™

---

## ğŸ“‹ é™„å½•ï¼šå…³é”®é…ç½®å‚è€ƒ

### æ¿€æ´»ç ç”Ÿæˆç®—æ³•å‚è€ƒ

```javascript
function generateCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // æ’é™¤ O/0/I/1
  const part = () => Array.from({ length: 4 }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
  return `${part()}-${part()}`;
}
```

### DeepSeek API è°ƒç”¨å‚è€ƒ

```javascript
const response = await fetch('https://api.deepseek.com/chat/completions', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${process.env.DEEPSEEK_API_KEY}`
  },
  body: JSON.stringify({
    model: 'deepseek-chat',
    messages: [
      { role: 'system', content: SYSTEM_PROMPT },
      { role: 'user', content: userPrompt }
    ],
    response_format: { type: 'json_object' },
    max_tokens: 1000,
    temperature: 0.8
  })
});
```

### å…«å­—æ—¶æŸ±å¤©å¹²æ¨ç®—è¡¨

```
æ—¥å¹²  ç”²/å·±  ä¹™/åºš  ä¸™/è¾›  ä¸/å£¬  æˆŠ/ç™¸
å­æ—¶   ç”²å­   ä¸™å­   æˆŠå­   åºšå­   å£¬å­
ä¸‘æ—¶   ä¹™ä¸‘   ä¸ä¸‘   å·±ä¸‘   è¾›ä¸‘   ç™¸ä¸‘
...ï¼ˆä»¥æ­¤ç±»æ¨ï¼‰
```

---
