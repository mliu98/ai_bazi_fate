好的，下面是一份面向前端开发的**话术库纯规则使用简介**（不调用任何大模型，完全靠标签匹配 + 模板填充来生成报告）。

---

## 话术库使用简介（纯规则模式）

### 一、整体思路

话术库本质上是一个**三维索引的文案数据库**。前端在用户完成生日填写和问卷后，通过三步计算出若干标签，再用这些标签去话术库里"按图索骥"取出对应条目，最后做简单的字符串替换（把 `{A}` 换成用户姓名）直接渲染到页面。全程不需要调用任何 API，是纯本地逻辑。

---

### 二、前端需要完成的三步计算

**第一步：算缘分值，得到 TIER 标签**

根据生日数据计算出 50-99 之间的缘分总分，对应关系如下：

- 90-99 → `TIER_S`
- 80-89 → `TIER_A`
- 70-79 → `TIER_B`
- 60-69 → `TIER_C`
- 50-59 → `TIER_D`

**第二步：解析八字五行，得到 WX 标签**

取双方出生年的天干地支，判断各自的日主五行（金木水火土），再查相生/相克关系表，确定一个 WX 标签，例如 A 是木命、B 是火命，则命中 `WX_MHSG`（木火相生）。七个可能的 WX 标签分别是：`WX_MHSG / WX_HTSG / WX_TJSG / WX_JSSG / WX_SMSG / WX_BH / WX_XK`。

**第三步：读取问卷答案，生成问卷标签**

15 道问卷每题的选项对应固定标签，前端在用户选完后直接映射，主要关键题如下：

| 题号 | 答案示例 | 对应标签 |
|------|---------|---------|
| Q1 | 已在一起 | `REL_TOGETHER` |
| Q1 | 暧昧中 | `REL_AMBIGUOUS` |
| Q8 | 吵过但好了 | `CONFLICT_HAD` |
| Q8 | 闹僵过 | `CONFLICT_HEAVY` |
| Q9 | 猜不透对方 | `HIM_UNSURE` |
| Q13 | 性格差异有点大 | `BARRIER_PERSONALITY` |
| Q13 | 不确定心意 | `BARRIER_HEART` |
| Q15 | 想知道何时在一起 | `WANT_WHEN` |

---

### 三、各报告模块的话术选取规则

拿到以上三类标签后，按如下规则从话术库里选条目，优先级从高到低：

> **优先**：同时命中 WX标签 + 问卷标签的话术
> **次选**：仅命中 WX标签的话术
> **兜底**：仅命中 TIER标签的通用话术（任何情况都有保底）

各模块具体取几条：

| 报告模块 | 取条数 | 构成说明 |
|---------|------|---------|
| 缘分亮点 | 4条 | 2条WX专属 + 2条问卷定向 |
| 相处建议 | 4条 | 2条WX专属 + 2条问卷定向 |
| 隐患预警（付费） | 2-3条 | 1条WX相克相关 + 1-2条问卷定向 |
| 流年排盘 | 4条 | 当前年+未来3年，各按TIER分支选 |
| 最佳时机（付费） | 1-2条 | REL标签 + TIER标签 + 流年三维交叉 |
| 转运技巧 | 4条 | 1-2条缺失五行补益 + 1条时间仪式 + 1条颜色/方位 |

---

### 四、最后一步：字符串替换渲染

每条话术里的 `{A}` 替换为用户自己的名字，`{B}` 替换为对方名字。部分转运话术里有 `{color_A}` 这类变量，按五行关系填入对应颜色即可。替换完成后直接渲染到对应模块，不需要任何额外处理。

---

### 五、一个完整例子

假设用户小红（木命）和对方小明（火命），缘分值 83 分，Q1 选「暧昧中」，Q9 选「猜不透对方」，Q13 选「不确定心意」：

- TIER 标签 → `TIER_A`
- WX 标签 → `WX_MHSG`
- 问卷标签 → `REL_AMBIGUOUS`、`HIM_UNSURE`、`BARRIER_HEART`

缘分亮点选取：从 `WX_MHSG` 池里取 2 条（如「木生火，你是他心里最旺的那把火」），从 `HIM_UNSURE` 或 `REL_AMBIGUOUS` 池里取 2 条。隐患预警：从 `WX_MHSG` 的火旺预警池取 1 条，再从 `BARRIER_HEART`（不确定心意）池取 1-2 条。把所有正文里的 `{A}` 换成「小红」、`{B}` 换成「小明」，完成。

---

### 六、需要注意的地方

有几个细节在实现时要留意。话术里有些条目同时带有 `badge` 字段（"注意" / "留意" / "预防"），前端要把这个 badge 渲染成对应的标签颜色，不能丢弃。转运话术里的缺失五行需要额外计算一次合盘五行分布，找到缺失的那个五行再去对应补益话术池取条目。流年排盘需要用当前年份计算年柱，这是前端要维护的少量额外逻辑。付费墙的处理是让前端先把隐患预警和最佳时机的内容选好，但默认渲染成模糊/遮罩状态，用户激活完整码后直接揭开，不需要再发请求。